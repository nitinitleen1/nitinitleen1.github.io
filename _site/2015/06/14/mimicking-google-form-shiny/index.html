<!DOCTYPE html>
<html lang="en">
  <!-- MIT license | Copyright Dean Attali 2016 -->
  <head>
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0">

  
  <title>Mimicking a Google Form with a Shiny app</title>
  

  <meta name="author" content="Nitin Singh" />
  
  
  <meta name="description" content="In this post we will walk through the steps required to build a shiny app that mimicks a Google Form. It will allow users to submit responses to some input fields, save their data, and allow admins to view the submitted responses. Like many of my other posts, it may...">
  
  
  <meta name="keywords" content="rstats,r,r shiny,shiny apps,r shiny apps,shiny developer,r shiny developer,shiny consultant,web application development with r using shiny">

  <link rel="alternate" type="application/rss+xml" title="Nitin Singh - A computer science student persuing B.TECH from IIITVADODARA and a programming enthusiast." href="/feed.xml" />

  
    
      <link rel="stylesheet" href="//maxcdn.bootstrapcdn.com/font-awesome/4.5.0/css/font-awesome.min.css" />
    
      
  
  
    
      <link rel="stylesheet" href="/css/bootstrap.min.css" />
    
      <link rel="stylesheet" href="/css/bootstrap-social.css" />
    
      <link rel="stylesheet" href="/css/main.css" />
    
    
  
  
    
      <link rel="stylesheet" href="//fonts.googleapis.com/css?family=Lora:400,700,400italic,700italic" />
    
      <link rel="stylesheet" href="//fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,800italic,400,300,600,700,800" />
    
  

    
  
  

  
  
  <!-- Facebook OpenGraph tags -->
  
  <meta property="og:title" content="Mimicking a Google Form with a Shiny app" />
  
  
  <meta property="og:type" content="website" />
  
  
  <meta property="og:url" content="http://localhost:4000/2015/06/14/mimicking-google-form-shiny/" />
  <link rel="canonical" href="http://localhost:4000/2015/06/14/mimicking-google-form-shiny/" />
  
  
  
  <meta property="og:image" content="http://deanattali.com/img/blog/mimic-google-form-shiny/mimic-google-form-shiny-final.png" />
  

  <!-- Twitter summary cards -->
  <meta name="twitter:card" content="summary" />
  <meta name="twitter:site" content="@nitinkumarsin10" />
  <meta name="twitter:creator" content="@nitinkumarsin10" />
  <meta name="twitter:title" content="Mimicking a Google Form with a Shiny app" />
  <meta name="twitter:description" content="In this post we will walk through the steps required to build a shiny app that mimicks a Google Form. It will allow users to submit responses to some input fields, save their data, and allow admins to view the submitted responses. Like many of my other posts, it may..." />
  
  <meta name="twitter:image" content="http://deanattali.com/img/blog/mimic-google-form-shiny/mimic-google-form-shiny-final.png" />
    

</head>


  <body>
  
    <nav class="navbar navbar-default navbar-fixed-top navbar-custom ">
  <div class="container-fluid">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#main-navbar">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="http://localhost:4000">Nitin Singh</a>
    </div>

    <div class="collapse navbar-collapse" id="main-navbar">
      <ul class="nav navbar-nav navbar-right">
      
        
          <li>
            
            





<a href="/">Blog</a>

          </li>
        
        
        
          <li>
            
            





<a href="/shiny">Shiny</a>

          </li>
        
        
        
          <li>
            
            





<a href="/projects">Projects</a>

          </li>
        
        
        
          <li>
            
            





<a href="/aboutme">About Me / Contact</a>

          </li>
        
        
		
		
		<li>
		  <a href="/search" class="nav-search-link" title="Search">
		    <span class="fa fa-search nav-search-icon"></span>
			<span class="nav-search-text">Search</span>
		  </a>
		</li>
		
      </ul>
    </div>
	
	
	<div class="avatar-container">
	  <div class="avatar-img-border">
	    <a href="http://localhost:4000 ">
	      <img class="avatar-img" src="/img/nitinimg.jpeg" />
		</a>
	  </div>
	</div>
	
	
  </div>
</nav>  


    <!-- TODO this file has become a mess, refactor it -->





<header class="header-section ">

<div class="intro-header no-img">
  <div class="container">
    <div class="row">
      <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
        <div class="post-heading">
          <h1>Mimicking a Google Form with a Shiny app</h1>
		  
		  
		  
		  <span class="post-meta">Posted on June 14, 2015</span>
		  
        </div>
      </div>
    </div>
  </div>
</div>
</header>





<div class="container">
  <div class="row">
    <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
      <article role="main" class="blog-post">
      	<p>In this post we will walk through the steps required to build a shiny app that mimicks a Google Form. It will allow users to submit responses to some input fields, save their data, and allow admins to view the submitted responses.  Like many of my other posts, it may seem lengthy, but that’s only because I like to go into fine details to ensure everything is as foolproof and reproducible as possible. In a <a href="http://deanattali.com/blog/shiny-persistent-data-storage">follow-up article</a> you can learn about different methods to store data in Shiny apps.</p>

<h1 id="table-of-contents">Table of contents</h1>

<ul>
  <li><a href="#motivation">Motivation</a></li>
  <li><a href="#overview">Overview</a>
    <ul>
      <li><a href="#note-storage">Note about persistent storage</a></li>
    </ul>
  </li>
  <li><a href="#prereqs">Prerequisites</a></li>
  <li><a href="#build-inputs">Build the basic UI (inputs)</a></li>
  <li><a href="#define-mandatory">Define mandatory fields</a>
    <ul>
      <li><a href="#mandatory-ui">Show which fields are mandatory in the UI</a></li>
    </ul>
  </li>
  <li><a href="#save">Save the response upon submission</a>
    <ul>
      <li><a href="#note-perms">Note regarding file permissions</a></li>
    </ul>
  </li>
  <li><a href="#thanks-msg">After submission show a “Thank you” message and let user submit again</a></li>
  <li><a href="#feedback-error">Better user feedback while submitting and on error</a></li>
  <li><a href="#add-table">Add table that shows all previous responses</a></li>
  <li><a href="#download">Add ability to download all responses</a></li>
  <li><a href="#admins">Restrict access to previous data to admins only</a></li>
  <li><a href="#updates">Updates</a></li>
</ul>

<h1 id="motivation">Motivation</h1>

<p>Last year I was fortunate enough to be a teaching assistant for <a href="https://twitter.com/stat545">STAT545</a> - a course at the University of British Columbia, taught by <a href="https://twitter.com/JennyBryan">Jenny Bryan</a>, that introduces R into the lives of student scientists. (It was especially special to me because just 12 months prior, that course taught <em>me</em> how to write my first line in R.) To facilitate communication with the students, we wanted to gather some basic information from them, such as their prefered name, email, and Twitter and Github handles. We didn’t want to simply have them all send us an email with this information, as we were trying to set an example of how to be techy and automated and modern :) Our first thought was to use a Google Form, but university policies didn’t quite allow for that because the data must be stored within Canadian borders, and with Google Forms it’d probably end up somewhere in the US. We also decided earlier that day that one of the course modules will be about shiny, so we figured we’d put our money where our mouths were, and attempt to collect student data via a shiny app. I was given the task of developing this shiny app, which was a great learning experience. You can view the original code for that app <a href="https://github.com/daattali/UBC-STAT545/tree/master/shiny-apps/request-basic-info">on GitHub</a> or <a href="http://daattali.com/shiny/request-basic-info/">visit the app yourself to see it in action</a>.</p>

<p>The idea of recording user-submitted form data can be applied to many differente scenarios. Seeing how successful the previous app was for our course, we decided to also collect all peer reviews of assignments in a similar shiny app. I created an app with a template for a marking sheet, and every week students would use the app to submit reviews for other students’ work. This worked great for us - you can see the original code <a href="https://github.com/daattali/UBC-STAT545/tree/master/shiny-apps/marking-sheet">on GitHub</a> or <a href="http://daattali.com/shiny/peer-review/">try the app out yourself</a>.</p>

<p>Since developing those apps, I’ve become a better shiny developer also wrote the <a href="https://github.com/daattali/shinyjs">shinyjs package</a> to help with many user-experience stuff like hiding/disabling/resetting inputs. I’ve also seen multiple people asking how to do this kind of thing with shiny, so my hope is that this post will be useful for others who are also looking to create user-submitted forms with shiny.</p>

<h1 id="overview">Overview</h1>

<p>The app we will build will be a form collecting data on a user’s R habits - their name, length of time using R, favourite R package, etc. You can see the result of this tutorial <a href="http://daattali.com/shiny/mimic-google-form/">on my shiny server</a> and the corresponding code <a href="https://github.com/daattali/shiny-server/blob/master/mimic-google-form/app.R">on GitHub</a>.  It looks like this:</p>

<p><a href="http://localhost:4000/img/blog/mimic-google-form-shiny/mimic-google-form-shiny-final.png"><img src="http://localhost:4000/img/blog/mimic-google-form-shiny/mimic-google-form-shiny-final.png" alt="Final app" /></a></p>

<p>The main idea is simple: create a UI with some inputs that users need to fill out, add a submit button, and save the response. Sounds simple, and it is! In this tutorial each response will be saved to a <em>.csv</em> file along with the timestamp of submission. To see all submissions that were made, we simply read all <em>csv</em> files and join them together. There will also be an “admin panel” that will show admin users all previous responses and allow them to download this data. When using Shiny Server Pro or paid shinyapps.io accounts, you can add authentication/login to your apps, and decide which usernames have admin access. Since my app is hosted on a free shiny server that doesn’t support authentication, it’ll just assume that everyone is an admin. I also like to focus <strong>a lot</strong> (arguably too much) on user experience, so this post will also discuss many small tips &amp; tricks that are optional but can be nice additions. Many of these use the <a href="https://github.com/daattali/shinyjs"><code class="highlighter-rouge">shinyjs</code></a> package, so instead of loading the package in the beginning, I’ll explicitly show when functions from <code class="highlighter-rouge">shinyjs</code> are used so that you know what functions are not core shiny.</p>

<h3 id="note-storage">Note about persistent storage</h3>

<p>One major component of this app is storing the user-submitted data in a way that would allow it to be retrieved later. This is an important topic of its own, and I wrote a <a href="http://deanattali.com/blog/shiny-persistent-data-storage">separate article</a> detailing the different storage options and how to use them. That article is also featured on <a href="http://shiny.rstudio.com/articles/persistent-data-storage.html">RStudio’s official Shiny articles</a> because it’s such an important skill. In this tutorial I will use the simplest approach for saving the data: every submission will be saved to its own <code class="highlighter-rouge">.csv</code> file.</p>

<p><strong>NOTE:</strong> this method should only be used if you have your own shiny server or are running the app on your own machine, and should not be used if your app is hosted on <code class="highlighter-rouge">shinyapps.io</code>. Using the local filesystem in shinyapps.io is a bad idea because every time your app is launched it will be on a different machine, and it will not have access to files saved by other users who were running the app on a different machine. If using shinyapps.io, you will need to use remote storage, which will be discussed in my next post. You can get a bit more information about why shinyapps.io can’t be used for local storage <a href="http://shiny.rstudio.com/articles/share-data.html">in the shiny docs</a>.</p>

<h1 id="prereqs">Prerequisites</h1>

<p>The following packages need to be installed in order for all the code to work:</p>

<ul>
  <li><a href="https://github.com/rstudio/DT"><code class="highlighter-rouge">DT</code></a> version 0.1.3 (as of today, this version is not yet on CRAN, so install it from GitHub with <code class="highlighter-rouge">devtools::install_github('rstudio/DT')</code></li>
  <li><code class="highlighter-rouge">shiny</code>, <code class="highlighter-rouge">shinyjs</code>, <code class="highlighter-rouge">dplyr</code>, <code class="highlighter-rouge">digest</code> - any version will do, you can install from CRAN</li>
</ul>

<h1 id="build-inputs">Build the basic UI (inputs)</h1>

<p>I generally prefer to split shiny apps into a <code class="highlighter-rouge">ui.R</code> and <code class="highlighter-rouge">server.R</code> file (with an additional <code class="highlighter-rouge">helpers.R</code> or <code class="highlighter-rouge">globals.R</code> if necessary), but for simplicity, I’ll place all the app code together in this tutorial. (In case you didn’t know: Shiny apps don’t have to be broken up into separate <code class="highlighter-rouge">ui.R</code> and <code class="highlighter-rouge">server.R</code> files, they can be completely defined in one file <a href="http://shiny.rstudio.com/articles/app-formats.html">as this Shiny article explains</a>)</p>

<p>Create a new file named <code class="highlighter-rouge">app.R</code> and copy the following code into it to build the input elements.</p>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="n">shinyApp</span><span class="p">(</span><span class="w">
  </span><span class="n">ui</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">fluidPage</span><span class="p">(</span><span class="w">
    </span><span class="n">titlePanel</span><span class="p">(</span><span class="s2">"Mimicking a Google Form with a Shiny app"</span><span class="p">),</span><span class="w">
    </span><span class="n">div</span><span class="p">(</span><span class="w">
      </span><span class="n">id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"form"</span><span class="p">,</span><span class="w">
      
      </span><span class="n">textInput</span><span class="p">(</span><span class="s2">"name"</span><span class="p">,</span><span class="w"> </span><span class="s2">"Name"</span><span class="p">,</span><span class="w"> </span><span class="s2">""</span><span class="p">),</span><span class="w">
      </span><span class="n">textInput</span><span class="p">(</span><span class="s2">"favourite_pkg"</span><span class="p">,</span><span class="w"> </span><span class="s2">"Favourite R package"</span><span class="p">),</span><span class="w">
      </span><span class="n">checkboxInput</span><span class="p">(</span><span class="s2">"used_shiny"</span><span class="p">,</span><span class="w"> </span><span class="s2">"I've built a Shiny app in R before"</span><span class="p">,</span><span class="w"> </span><span class="kc">FALSE</span><span class="p">),</span><span class="w">
      </span><span class="n">sliderInput</span><span class="p">(</span><span class="s2">"r_num_years"</span><span class="p">,</span><span class="w"> </span><span class="s2">"Number of years using R"</span><span class="p">,</span><span class="w"> </span><span class="m">0</span><span class="p">,</span><span class="w"> </span><span class="m">25</span><span class="p">,</span><span class="w"> </span><span class="m">2</span><span class="p">,</span><span class="w"> </span><span class="n">ticks</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">FALSE</span><span class="p">),</span><span class="w">
      </span><span class="n">selectInput</span><span class="p">(</span><span class="s2">"os_type"</span><span class="p">,</span><span class="w"> </span><span class="s2">"Operating system used most frequently"</span><span class="p">,</span><span class="w">
                  </span><span class="nf">c</span><span class="p">(</span><span class="s2">""</span><span class="p">,</span><span class="w">  </span><span class="s2">"Windows"</span><span class="p">,</span><span class="w"> </span><span class="s2">"Mac"</span><span class="p">,</span><span class="w"> </span><span class="s2">"Linux"</span><span class="p">)),</span><span class="w">
      </span><span class="n">actionButton</span><span class="p">(</span><span class="s2">"submit"</span><span class="p">,</span><span class="w"> </span><span class="s2">"Submit"</span><span class="p">,</span><span class="w"> </span><span class="n">class</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"btn-primary"</span><span class="p">)</span><span class="w">
    </span><span class="p">)</span><span class="w">
  </span><span class="p">),</span><span class="w">
  </span><span class="n">server</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">function</span><span class="p">(</span><span class="n">input</span><span class="p">,</span><span class="w"> </span><span class="n">output</span><span class="p">,</span><span class="w"> </span><span class="n">session</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">)</span><span class="w">
</span></code></pre>
</div>

<p>Most of this code is simply setting up a shiny app and adding a few input fields and a button to a div element named <code class="highlighter-rouge">form</code>.</p>

<p>After saving this file, you should be able to run it either with <code class="highlighter-rouge">shiny::runApp()</code> or by clicking the “Run App” button in RStudio. The app simply shows the input fields and the submit button, but does nothing yet.</p>

<h1 id="define-mandatory">Define mandatory fields</h1>

<p>We want everyone to at least tell us their name and favourite package, so let’s ensure the submit button is only enabled if both of those fields are filled out. We need to use <code class="highlighter-rouge">shinyjs</code> for that, so you need to add a call to <code class="highlighter-rouge">shinyjs::useShinyjs()</code> anywhere in the UI. In the global scope (above the definition of <code class="highlighter-rouge">shinyApp</code>, outside the UI and server code), define the mandatory fields:</p>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="n">fieldsMandatory</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="s2">"name"</span><span class="p">,</span><span class="w"> </span><span class="s2">"favourite_pkg"</span><span class="p">)</span><span class="w">
</span></code></pre>
</div>

<p>Now we can use the <code class="highlighter-rouge">toggleState</code> function to enable/disable the submit button based on a condition. The condition is whether or not all mandatory fields have been filled. To calculate that, we can loop through the mandatory fields and check their values.  Add the following code to the server portion of the app:</p>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="n">observe</span><span class="p">({</span><span class="w">
  </span><span class="c1"># check if all mandatory fields have a value
</span><span class="w">  </span><span class="n">mandatoryFilled</span><span class="w"> </span><span class="o">&lt;-</span><span class="w">
    </span><span class="n">vapply</span><span class="p">(</span><span class="n">fieldsMandatory</span><span class="p">,</span><span class="w">
           </span><span class="k">function</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
             </span><span class="o">!</span><span class="nf">is.null</span><span class="p">(</span><span class="n">input</span><span class="p">[[</span><span class="n">x</span><span class="p">]])</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">input</span><span class="p">[[</span><span class="n">x</span><span class="p">]]</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="s2">""</span><span class="w">
           </span><span class="p">},</span><span class="w">
           </span><span class="n">logical</span><span class="p">(</span><span class="m">1</span><span class="p">))</span><span class="w">
  </span><span class="n">mandatoryFilled</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">all</span><span class="p">(</span><span class="n">mandatoryFilled</span><span class="p">)</span><span class="w">
  
  </span><span class="c1"># enable/disable the submit button
</span><span class="w">  </span><span class="n">shinyjs</span><span class="o">::</span><span class="n">toggleState</span><span class="p">(</span><span class="n">id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"submit"</span><span class="p">,</span><span class="w"> </span><span class="n">condition</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">mandatoryFilled</span><span class="p">)</span><span class="w">
</span><span class="p">})</span><span class="w">
</span></code></pre>
</div>

<p>Now try running the app again, and you’ll see the submit button is only enabled when these fields have a value.</p>

<h3 id="mandatory-ui">Show which fields are mandatory in the UI</h3>

<p>If you want to be extra fancy, you can add a red asterisk to the mandatory fields. Here’s a neat though possibly overcomplicated approach to do this:  define a function that takes an input label and adds an asterisk to it (you can define it in the global scope):</p>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="n">labelMandatory</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="k">function</span><span class="p">(</span><span class="n">label</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
  </span><span class="n">tagList</span><span class="p">(</span><span class="w">
    </span><span class="n">label</span><span class="p">,</span><span class="w">
    </span><span class="n">span</span><span class="p">(</span><span class="s2">"*"</span><span class="p">,</span><span class="w"> </span><span class="n">class</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"mandatory_star"</span><span class="p">)</span><span class="w">
  </span><span class="p">)</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>
</div>

<p>To use it, simply wrap the <code class="highlighter-rouge">label</code> argument of both mandatory input element with <code class="highlighter-rouge">labelMandatory</code>. For example, <code class="highlighter-rouge">textInput("name", labelMandatory("Name"), "")</code>.</p>

<p>To make the asterisk red, we need to add some CSS, so define the CSS in the global scope:</p>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="n">appCSS</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="s2">".mandatory_star { color: red; }"</span><span class="w">
</span></code></pre>
</div>

<p>And add the CSS to the app by calling <code class="highlighter-rouge">shinyjs::inlineCSS(appCSS)</code> in the UI.</p>

<p>The complete code so far should look like this (it might be a good idea to just copy and paste this, to make sure you have the right code):</p>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="n">fieldsMandatory</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="s2">"name"</span><span class="p">,</span><span class="w"> </span><span class="s2">"favourite_pkg"</span><span class="p">)</span><span class="w">

</span><span class="n">labelMandatory</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="k">function</span><span class="p">(</span><span class="n">label</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
  </span><span class="n">tagList</span><span class="p">(</span><span class="w">
    </span><span class="n">label</span><span class="p">,</span><span class="w">
    </span><span class="n">span</span><span class="p">(</span><span class="s2">"*"</span><span class="p">,</span><span class="w"> </span><span class="n">class</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"mandatory_star"</span><span class="p">)</span><span class="w">
  </span><span class="p">)</span><span class="w">
</span><span class="p">}</span><span class="w">

</span><span class="n">appCSS</span><span class="w"> </span><span class="o">&lt;-</span><span class="w">
  </span><span class="s2">".mandatory_star { color: red; }"</span><span class="w">

</span><span class="n">shinyApp</span><span class="p">(</span><span class="w">
  </span><span class="n">ui</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">fluidPage</span><span class="p">(</span><span class="w">
    </span><span class="n">shinyjs</span><span class="o">::</span><span class="n">useShinyjs</span><span class="p">(),</span><span class="w">
    </span><span class="n">shinyjs</span><span class="o">::</span><span class="n">inlineCSS</span><span class="p">(</span><span class="n">appCSS</span><span class="p">),</span><span class="w">
    </span><span class="n">titlePanel</span><span class="p">(</span><span class="s2">"Mimicking a Google Form with a Shiny app"</span><span class="p">),</span><span class="w">
    
    </span><span class="n">div</span><span class="p">(</span><span class="w">
      </span><span class="n">id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"form"</span><span class="p">,</span><span class="w">
      
      </span><span class="n">textInput</span><span class="p">(</span><span class="s2">"name"</span><span class="p">,</span><span class="w"> </span><span class="n">labelMandatory</span><span class="p">(</span><span class="s2">"Name"</span><span class="p">),</span><span class="w"> </span><span class="s2">""</span><span class="p">),</span><span class="w">
      </span><span class="n">textInput</span><span class="p">(</span><span class="s2">"favourite_pkg"</span><span class="p">,</span><span class="w"> </span><span class="n">labelMandatory</span><span class="p">(</span><span class="s2">"Favourite R package"</span><span class="p">)),</span><span class="w">
      </span><span class="n">checkboxInput</span><span class="p">(</span><span class="s2">"used_shiny"</span><span class="p">,</span><span class="w"> </span><span class="s2">"I've built a Shiny app in R before"</span><span class="p">,</span><span class="w"> </span><span class="kc">FALSE</span><span class="p">),</span><span class="w">
      </span><span class="n">sliderInput</span><span class="p">(</span><span class="s2">"r_num_years"</span><span class="p">,</span><span class="w"> </span><span class="s2">"Number of years using R"</span><span class="p">,</span><span class="w"> </span><span class="m">0</span><span class="p">,</span><span class="w"> </span><span class="m">25</span><span class="p">,</span><span class="w"> </span><span class="m">2</span><span class="p">,</span><span class="w"> </span><span class="n">ticks</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">FALSE</span><span class="p">),</span><span class="w">
      </span><span class="n">selectInput</span><span class="p">(</span><span class="s2">"os_type"</span><span class="p">,</span><span class="w"> </span><span class="s2">"Operating system used most frequently"</span><span class="p">,</span><span class="w">
                  </span><span class="nf">c</span><span class="p">(</span><span class="s2">""</span><span class="p">,</span><span class="w">  </span><span class="s2">"Windows"</span><span class="p">,</span><span class="w"> </span><span class="s2">"Mac"</span><span class="p">,</span><span class="w"> </span><span class="s2">"Linux"</span><span class="p">)),</span><span class="w">
      </span><span class="n">actionButton</span><span class="p">(</span><span class="s2">"submit"</span><span class="p">,</span><span class="w"> </span><span class="s2">"Submit"</span><span class="p">,</span><span class="w"> </span><span class="n">class</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"btn-primary"</span><span class="p">)</span><span class="w">
    </span><span class="p">)</span><span class="w">
  </span><span class="p">),</span><span class="w">
  </span><span class="n">server</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">function</span><span class="p">(</span><span class="n">input</span><span class="p">,</span><span class="w"> </span><span class="n">output</span><span class="p">,</span><span class="w"> </span><span class="n">session</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="n">observe</span><span class="p">({</span><span class="w">
      </span><span class="n">mandatoryFilled</span><span class="w"> </span><span class="o">&lt;-</span><span class="w">
        </span><span class="n">vapply</span><span class="p">(</span><span class="n">fieldsMandatory</span><span class="p">,</span><span class="w">
               </span><span class="k">function</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
                 </span><span class="o">!</span><span class="nf">is.null</span><span class="p">(</span><span class="n">input</span><span class="p">[[</span><span class="n">x</span><span class="p">]])</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">input</span><span class="p">[[</span><span class="n">x</span><span class="p">]]</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="s2">""</span><span class="w">
               </span><span class="p">},</span><span class="w">
               </span><span class="n">logical</span><span class="p">(</span><span class="m">1</span><span class="p">))</span><span class="w">
      </span><span class="n">mandatoryFilled</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">all</span><span class="p">(</span><span class="n">mandatoryFilled</span><span class="p">)</span><span class="w">
      
      </span><span class="n">shinyjs</span><span class="o">::</span><span class="n">toggleState</span><span class="p">(</span><span class="n">id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"submit"</span><span class="p">,</span><span class="w"> </span><span class="n">condition</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">mandatoryFilled</span><span class="p">)</span><span class="w">
    </span><span class="p">})</span><span class="w">    
  </span><span class="p">}</span><span class="w">
</span><span class="p">)</span><span class="w">
</span></code></pre>
</div>

<h1 id="save">Save the response upon submission</h1>

<p>The most important part of the app is to save the user’s response.  First we need to define (a) what input fields we want to store and (b) what directory to use to store all the responses. I also like to add the submission timestamp to each submission, so I also want to define (c) a function that returns the current time as an integer. Let’s define these three things in the global scope:</p>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="n">fieldsAll</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="s2">"name"</span><span class="p">,</span><span class="w"> </span><span class="s2">"favourite_pkg"</span><span class="p">,</span><span class="w"> </span><span class="s2">"used_shiny"</span><span class="p">,</span><span class="w"> </span><span class="s2">"r_num_years"</span><span class="p">,</span><span class="w"> </span><span class="s2">"os_type"</span><span class="p">)</span><span class="w">
</span><span class="n">responsesDir</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">file.path</span><span class="p">(</span><span class="s2">"responses"</span><span class="p">)</span><span class="w">
</span><span class="n">epochTime</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="k">function</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w">
  </span><span class="nf">as.integer</span><span class="p">(</span><span class="n">Sys.time</span><span class="p">())</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>
</div>

<p>Make sure you create a <code class="highlighter-rouge">responses</code> directory so that the saved responses can go there.</p>

<p>Next we need to have a way to gather all the form data (plus the timestamp) into a format that can be saved as a <em>csv</em>. We can do this easily by looping over the input fields. Note that we need to transpose the data to get it into the right shape that we want (1 row = 1 observation = 1 user submission). Add the following reactive expression to the server:</p>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="n">formData</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">reactive</span><span class="p">({</span><span class="w">
  </span><span class="n">data</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">sapply</span><span class="p">(</span><span class="n">fieldsAll</span><span class="p">,</span><span class="w"> </span><span class="k">function</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="w"> </span><span class="n">input</span><span class="p">[[</span><span class="n">x</span><span class="p">]])</span><span class="w">
  </span><span class="n">data</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="n">data</span><span class="p">,</span><span class="w"> </span><span class="n">timestamp</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">epochTime</span><span class="p">())</span><span class="w">
  </span><span class="n">data</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">t</span><span class="p">(</span><span class="n">data</span><span class="p">)</span><span class="w">
  </span><span class="n">data</span><span class="w">
</span><span class="p">})</span><span class="w">
</span></code></pre>
</div>

<p>The last part is to actually save the data. As I said earlier, in this post we will save the data to a local file, but in my next post I’ll show how to alter the following function in order to save to other sources. When saving the user responses locally to a file, there are two options: either save all responses to one file, or save each response as its own file. The first approach might sound like it makes more sense, but I wanted to avoid it for two reasons: first of all, it’s slower because in order to save (add a new row to the file), we’d need to first read the whole file to know where to add the new row. Secondly, this approach is not thread-safe, which means that if two people submit at the same time, one of their responses will get lost. So I opted to use the second solution - each submission is its own file. It might seem weird, but it works.</p>

<p>To ensure that we don’t lose any submissions, we need to make sure that no two files have the same name. It’s difficult to 100% guarantee that, but it’s easy enough to be almost sure that filenames are unique by adding some randomness to them. However, instead of having turly random characters in the filename, I went a slightly different way: I make the filename a concatenation of the current time and the md5 hash of the submission data. This way the only realistic way that two submissions will overwrite each other is if they happen at the same second and have the exact same data.  Here is the function to save the response (add to the server):</p>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="n">saveData</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="k">function</span><span class="p">(</span><span class="n">data</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
  </span><span class="n">fileName</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">sprintf</span><span class="p">(</span><span class="s2">"%s_%s.csv"</span><span class="p">,</span><span class="w">
                      </span><span class="n">humanTime</span><span class="p">(),</span><span class="w">
                      </span><span class="n">digest</span><span class="o">::</span><span class="n">digest</span><span class="p">(</span><span class="n">data</span><span class="p">))</span><span class="w">
  
  </span><span class="n">write.csv</span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">data</span><span class="p">,</span><span class="w"> </span><span class="n">file</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">file.path</span><span class="p">(</span><span class="n">responsesDir</span><span class="p">,</span><span class="w"> </span><span class="n">fileName</span><span class="p">),</span><span class="w">
            </span><span class="n">row.names</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">FALSE</span><span class="p">,</span><span class="w"> </span><span class="n">quote</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">TRUE</span><span class="p">)</span><span class="w">
</span><span class="p">}</span><span class="w">

</span><span class="c1"># action to take when submit button is pressed
</span><span class="n">observeEvent</span><span class="p">(</span><span class="n">input</span><span class="o">$</span><span class="n">submit</span><span class="p">,</span><span class="w"> </span><span class="p">{</span><span class="w">
  </span><span class="n">saveData</span><span class="p">(</span><span class="n">formData</span><span class="p">())</span><span class="w">
</span><span class="p">})</span><span class="w">
</span></code></pre>
</div>

<p>Notice that I used <code class="highlighter-rouge">humanTime()</code> instead of <code class="highlighter-rouge">epochTime()</code> because I wanted the filename to have a more human-friendly timestamp. You’ll need to define <code class="highlighter-rouge">humanTime()</code> as</p>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="n">humanTime</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="k">function</span><span class="p">()</span><span class="w"> </span><span class="n">format</span><span class="p">(</span><span class="n">Sys.time</span><span class="p">(),</span><span class="w"> </span><span class="s2">"%Y%m%d-%H%M%OS"</span><span class="p">)</span><span class="w">
</span></code></pre>
</div>

<p>Now you should be able to run the app, enter input, save, and see a new file created for every submission. If you get an error when saving, make sure the <code class="highlighter-rouge">responses</code> directory exists and you have write permissions.</p>

<h3 id="note-perms">Note regarding file permissions</h3>

<p>If you are running the app on a shiny server, it’s very improtant to understand user permissions. By default, all apps are run as the <code class="highlighter-rouge">shiny</code> user, and that user will probably not have write permission on folders you create.  You should either add write permissions to <code class="highlighter-rouge">shiny</code>, or change the running user to yourself. See more information on how to do this <a href="http://deanattali.com/2015/05/09/setup-rstudio-shiny-server-digital-ocean#shiny-user-perms">in this post</a>.</p>

<h1 id="thanks-msg">After submission show a “Thank you” message and let user submit again</h1>

<p>Right now, after submitting a response, there is no feedback and the user will think nothing happened. Let’s add a “Thank you” message that will get shown, and add a button to allow the user to submit another response (if it makes sense for your app).</p>

<p>Add the “thank you” section to the UI <em>after</em> the <code class="highlighter-rouge">form</code> div (initialize it as hidden because we only want to show it after a submission):</p>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="n">div</span><span class="p">(</span><span class="n">id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"form"</span><span class="p">,</span><span class="w"> </span><span class="n">...</span><span class="p">),</span><span class="w">
</span><span class="n">shinyjs</span><span class="o">::</span><span class="n">hidden</span><span class="p">(</span><span class="w">
  </span><span class="n">div</span><span class="p">(</span><span class="w">
    </span><span class="n">id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"thankyou_msg"</span><span class="p">,</span><span class="w">
    </span><span class="n">h</span><span class="m">3</span><span class="p">(</span><span class="s2">"Thanks, your response was submitted successfully!"</span><span class="p">),</span><span class="w">
    </span><span class="n">actionLink</span><span class="p">(</span><span class="s2">"submit_another"</span><span class="p">,</span><span class="w"> </span><span class="s2">"Submit another response"</span><span class="p">)</span><span class="w">
  </span><span class="p">)</span><span class="w">
</span><span class="p">)</span><span class="w">  
</span></code></pre>
</div>

<p>And in the server, after saving the data we now want to reset the form, hide it, and show the thank you message:</p>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="c1"># action to take when submit button is pressed
</span><span class="n">observeEvent</span><span class="p">(</span><span class="n">input</span><span class="o">$</span><span class="n">submit</span><span class="p">,</span><span class="w"> </span><span class="p">{</span><span class="w">
  </span><span class="n">saveData</span><span class="p">(</span><span class="n">formData</span><span class="p">())</span><span class="w">
  </span><span class="n">shinyjs</span><span class="o">::</span><span class="n">reset</span><span class="p">(</span><span class="s2">"form"</span><span class="p">)</span><span class="w">
  </span><span class="n">shinyjs</span><span class="o">::</span><span class="n">hide</span><span class="p">(</span><span class="s2">"form"</span><span class="p">)</span><span class="w">
  </span><span class="n">shinyjs</span><span class="o">::</span><span class="n">show</span><span class="p">(</span><span class="s2">"thankyou_msg"</span><span class="p">)</span><span class="w">
</span><span class="p">})</span><span class="w">
</span></code></pre>
</div>

<p>Note that the this observer should overwrite the previous one because we added 3 expressions.</p>

<p>We also need to add an observer to clicking on the “Submit another response” button that will do the opposite: hide the thank you message and show the form (add the following to the server):</p>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="n">observeEvent</span><span class="p">(</span><span class="n">input</span><span class="o">$</span><span class="n">submit_another</span><span class="p">,</span><span class="w"> </span><span class="p">{</span><span class="w">
  </span><span class="n">shinyjs</span><span class="o">::</span><span class="n">show</span><span class="p">(</span><span class="s2">"form"</span><span class="p">)</span><span class="w">
  </span><span class="n">shinyjs</span><span class="o">::</span><span class="n">hide</span><span class="p">(</span><span class="s2">"thankyou_msg"</span><span class="p">)</span><span class="w">
</span><span class="p">})</span><span class="w">    
</span></code></pre>
</div>

<p>Now you should be able to submit multiple responses with a clear indication every time that it succeeded.</p>

<h1 id="feedback-error">Better user feedback while submitting and on error</h1>

<p>Right now there is no feedback to the user when their response is being saved and if it encounters an error, the app will crash.  Let’s fix that! First we need to add a “Submitting…” progress message and an error message container to the UI - add them inside the <code class="highlighter-rouge">form</code> div, just after the submit button:</p>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="n">shinyjs</span><span class="o">::</span><span class="n">hidden</span><span class="p">(</span><span class="w">
  </span><span class="n">span</span><span class="p">(</span><span class="n">id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"submit_msg"</span><span class="p">,</span><span class="w"> </span><span class="s2">"Submitting..."</span><span class="p">),</span><span class="w">
  </span><span class="n">div</span><span class="p">(</span><span class="n">id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"error"</span><span class="p">,</span><span class="w">
      </span><span class="n">div</span><span class="p">(</span><span class="n">br</span><span class="p">(),</span><span class="w"> </span><span class="n">tags</span><span class="o">$</span><span class="n">b</span><span class="p">(</span><span class="s2">"Error: "</span><span class="p">),</span><span class="w"> </span><span class="n">span</span><span class="p">(</span><span class="n">id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"error_msg"</span><span class="p">))</span><span class="w">
  </span><span class="p">)</span><span class="w">
</span><span class="p">)</span><span class="w">
</span></code></pre>
</div>

<p>Now let’s hook up the logic. When the “submit” button is pressed, we want to: disable the button from being pressed again, show the “Submitting…” message, and hide any previous errors. We want to reverse these actions when saving the data is finished. If an error occurs while saving the data, we want to show the error message.  All these sorts of actions are why <code class="highlighter-rouge">shinyjs</code> was created, and it will help us here. Change the observer of <code class="highlighter-rouge">input$submit</code> once again:</p>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="n">observeEvent</span><span class="p">(</span><span class="n">input</span><span class="o">$</span><span class="n">submit</span><span class="p">,</span><span class="w"> </span><span class="p">{</span><span class="w">
  </span><span class="n">shinyjs</span><span class="o">::</span><span class="n">disable</span><span class="p">(</span><span class="s2">"submit"</span><span class="p">)</span><span class="w">
  </span><span class="n">shinyjs</span><span class="o">::</span><span class="n">show</span><span class="p">(</span><span class="s2">"submit_msg"</span><span class="p">)</span><span class="w">
  </span><span class="n">shinyjs</span><span class="o">::</span><span class="n">hide</span><span class="p">(</span><span class="s2">"error"</span><span class="p">)</span><span class="w">
  
  </span><span class="n">tryCatch</span><span class="p">({</span><span class="w">
    </span><span class="n">saveData</span><span class="p">(</span><span class="n">formData</span><span class="p">())</span><span class="w">
    </span><span class="n">shinyjs</span><span class="o">::</span><span class="n">reset</span><span class="p">(</span><span class="s2">"form"</span><span class="p">)</span><span class="w">
    </span><span class="n">shinyjs</span><span class="o">::</span><span class="n">hide</span><span class="p">(</span><span class="s2">"form"</span><span class="p">)</span><span class="w">
    </span><span class="n">shinyjs</span><span class="o">::</span><span class="n">show</span><span class="p">(</span><span class="s2">"thankyou_msg"</span><span class="p">)</span><span class="w">
  </span><span class="p">},</span><span class="w">
  </span><span class="n">error</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">function</span><span class="p">(</span><span class="n">err</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="n">shinyjs</span><span class="o">::</span><span class="n">html</span><span class="p">(</span><span class="s2">"error_msg"</span><span class="p">,</span><span class="w"> </span><span class="n">err</span><span class="o">$</span><span class="n">message</span><span class="p">)</span><span class="w">
    </span><span class="n">shinyjs</span><span class="o">::</span><span class="n">show</span><span class="p">(</span><span class="n">id</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"error"</span><span class="p">,</span><span class="w"> </span><span class="n">anim</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">TRUE</span><span class="p">,</span><span class="w"> </span><span class="n">animType</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"fade"</span><span class="p">)</span><span class="w">
  </span><span class="p">},</span><span class="w">
  </span><span class="n">finally</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="n">shinyjs</span><span class="o">::</span><span class="n">enable</span><span class="p">(</span><span class="s2">"submit"</span><span class="p">)</span><span class="w">
    </span><span class="n">shinyjs</span><span class="o">::</span><span class="n">hide</span><span class="p">(</span><span class="s2">"submit_msg"</span><span class="p">)</span><span class="w">
  </span><span class="p">})</span><span class="w">
</span><span class="p">})</span><span class="w">
</span></code></pre>
</div>

<p>Just as a small extra bonus, I like to make error messages red, so I added <code class="highlighter-rouge">#error { color: red; }</code> to the <code class="highlighter-rouge">appCSS</code> string that we defined in the beginning, so now <code class="highlighter-rouge">appCSS</code> is:</p>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="n">appCSS</span><span class="w"> </span><span class="o">&lt;-</span><span class="w">
  </span><span class="s2">".mandatory_star { color: red; }
   #error { color: red; }"</span><span class="w">
</span></code></pre>
</div>

<p><strong>Now you have a fully functioning form shiny app!</strong> The only thing that’s missing so far is a way to view the responses directly in the app. Remember that all the responses are saved locally, so you can also just open the files manually or use any approach you want to open the files.</p>

<h1 id="add-table">Add table that shows all previous responses</h1>

<p><em>Note: this section is not visually identical to the app shown <a href="http://daattali.com/shiny/mimic-google-form/">on my shiny server</a> because in my app I placed the table to the right of the form, and the code given here will place the table above the form.</em></p>

<p>Now that we can submit responses smoothly, it’d be nice to also be able to view submitted responses in the app. First we need to add a dataTable placeholder to the UI (add it just before the <code class="highlighter-rouge">form</code> div, after the <code class="highlighter-rouge">titlePanel</code>):</p>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="n">DT</span><span class="o">::</span><span class="n">dataTableOutput</span><span class="p">(</span><span class="s2">"responsesTable"</span><span class="p">),</span><span class="w">
</span></code></pre>
</div>

<p>The main issue we need to solve in this section is how to retrieve all previous submissions. To do this, we’ll look at all the files in the <code class="highlighter-rouge">responses</code> directory, read each one into a data.frame separately, and then use <code class="highlighter-rouge">dplyr::rbind_all</code> to concatenate all the responses together. Note that this will only work if all the response files have exactly the same fields, so if you change your app to add new fields, you’ll probably need to either remove all previous submissions or make your own script to add a default value to the new field of all previous submissions.</p>

<p>Here’s our function that will retrieve all submissions and load them into a data.frame. You can define it in the global scope.</p>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="n">loadData</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="k">function</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w">
  </span><span class="n">files</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">list.files</span><span class="p">(</span><span class="n">file.path</span><span class="p">(</span><span class="n">responsesDir</span><span class="p">),</span><span class="w"> </span><span class="n">full.names</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">TRUE</span><span class="p">)</span><span class="w">
  </span><span class="n">data</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">lapply</span><span class="p">(</span><span class="n">files</span><span class="p">,</span><span class="w"> </span><span class="n">read.csv</span><span class="p">,</span><span class="w"> </span><span class="n">stringsAsFactors</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">FALSE</span><span class="p">)</span><span class="w">
  </span><span class="n">data</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">dplyr</span><span class="o">::</span><span class="n">rbind_all</span><span class="p">(</span><span class="n">data</span><span class="p">)</span><span class="w">
  </span><span class="n">data</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre>
</div>

<p>Now that we have this function, we just need to tell the dataTable in the UI to display that data. Add the following to the server:</p>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="n">output</span><span class="o">$</span><span class="n">responsesTable</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">DT</span><span class="o">::</span><span class="n">renderDataTable</span><span class="p">(</span><span class="w">
  </span><span class="n">loadData</span><span class="p">(),</span><span class="w">
  </span><span class="n">rownames</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">FALSE</span><span class="p">,</span><span class="w">
  </span><span class="n">options</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">list</span><span class="p">(</span><span class="n">searching</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">FALSE</span><span class="p">,</span><span class="w"> </span><span class="n">lengthChange</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">FALSE</span><span class="p">)</span><span class="w">
</span><span class="p">)</span><span class="w"> 
</span></code></pre>
</div>

<p>Now when you run the app you should be able to see your previous submissions, assuming you followed the instructions without problems.</p>

<h1 id="download">Add ability to download all responses</h1>

<p>It would also be very handy to be able to download all the reponses into a single file. Let’s add a download button to the UI, either just before or just after the dataTable:</p>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="n">downloadButton</span><span class="p">(</span><span class="s2">"downloadBtn"</span><span class="p">,</span><span class="w"> </span><span class="s2">"Download responses"</span><span class="p">),</span><span class="w">
</span></code></pre>
</div>

<p>We already have a function for retrieving the data, so all we need to do is tell the download hadler to use it. Add the following to the server:</p>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="n">output</span><span class="o">$</span><span class="n">downloadBtn</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">downloadHandler</span><span class="p">(</span><span class="w">
  </span><span class="n">filename</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">function</span><span class="p">()</span><span class="w"> </span><span class="p">{</span><span class="w"> 
    </span><span class="n">sprintf</span><span class="p">(</span><span class="s2">"mimic-google-form_%s.csv"</span><span class="p">,</span><span class="w"> </span><span class="n">humanTime</span><span class="p">())</span><span class="w">
  </span><span class="p">},</span><span class="w">
  </span><span class="n">content</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">function</span><span class="p">(</span><span class="n">file</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="n">write.csv</span><span class="p">(</span><span class="n">loadData</span><span class="p">(),</span><span class="w"> </span><span class="n">file</span><span class="p">,</span><span class="w"> </span><span class="n">row.names</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="kc">FALSE</span><span class="p">)</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">)</span><span class="w">
</span></code></pre>
</div>

<p>Almost done!</p>

<h1 id="admins">Restrict access to previous data to admins only</h1>

<p>The only missing piece is that right now everyone will see all the responses, and you might want to restrict that access to admins only.  This is only possible if you enable authentication, which is available in Shiny Server Pro and in the paid shinyapps.io accounts. Without authentication, everyone who goes to your app will be treated equally, but with authentication you can give different people different usernames and decide which users are considered admins.</p>

<p>The first thing we need to do is remove all the admin-only content from the UI and only generate it if the current user is an admin. Remove the <code class="highlighter-rouge">dataTableOutput</code> and the <code class="highlighter-rouge">downloadButton</code> from the UI, and instead add a dynamic UI element:</p>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="n">uiOutput</span><span class="p">(</span><span class="s2">"adminPanelContainer"</span><span class="p">),</span><span class="w">
</span></code></pre>
</div>

<p>We’ll re-define the dataTable and download button in the server, but only if the user is an admin. The following code ensures that for non-admins, nothing gets rendered in the admin panel, but admins can see the table and download button (add this to the server):</p>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="n">output</span><span class="o">$</span><span class="n">adminPanelContainer</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">renderUI</span><span class="p">({</span><span class="w">
  </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="n">isAdmin</span><span class="p">())</span><span class="w"> </span><span class="nf">return</span><span class="p">()</span><span class="w">
  
  </span><span class="n">wellPanel</span><span class="p">(</span><span class="w">
    </span><span class="n">h</span><span class="m">2</span><span class="p">(</span><span class="s2">"Previous responses (only visible to admins)"</span><span class="p">),</span><span class="w">
    </span><span class="n">downloadButton</span><span class="p">(</span><span class="s2">"downloadBtn"</span><span class="p">,</span><span class="w"> </span><span class="s2">"Download responses"</span><span class="p">),</span><span class="w"> </span><span class="n">br</span><span class="p">(),</span><span class="w"> </span><span class="n">br</span><span class="p">(),</span><span class="w">
    </span><span class="n">DT</span><span class="o">::</span><span class="n">dataTableOutput</span><span class="p">(</span><span class="s2">"responsesTable"</span><span class="p">)</span><span class="w">
  </span><span class="p">)</span><span class="w">
</span><span class="p">})</span><span class="w"> 
</span></code></pre>
</div>

<p>All that’s left is to decide if the user is an admin or not (note the <code class="highlighter-rouge">isAdmin()</code> call in the previous code chunk, we need to define that function). If authentication is enabled, then the logged in user’s name will be available to us in the <code class="highlighter-rouge">session$user</code> variable. If there is no authentication, it will be <code class="highlighter-rouge">NULL</code>. Let’s say John and Sally are the app developers so they should be the admins, we can define a list of admin usernames in the global scope:</p>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="n">adminUsers</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="s2">"john"</span><span class="p">,</span><span class="w"> </span><span class="s2">"sally"</span><span class="p">)</span><span class="w">
</span></code></pre>
</div>

<p>Now that we know who are the potential admins, we can use this code (in the server) to determine if the current user is an admin:</p>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="n">isAdmin</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">reactive</span><span class="p">({</span><span class="w">
  </span><span class="o">!</span><span class="nf">is.null</span><span class="p">(</span><span class="n">session</span><span class="o">$</span><span class="n">user</span><span class="p">)</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">session</span><span class="o">$</span><span class="n">user</span><span class="w"> </span><span class="o">%in%</span><span class="w"> </span><span class="n">adminUsers</span><span class="w">
</span><span class="p">})</span><span class="w">  
</span></code></pre>
</div>

<p>This will ensure that only if “john” or “sally” are using the app, the admin panel will show up.  For illustration purposes, since many of you don’t have authentication support, you can change the <code class="highlighter-rouge">isAdmin</code> to</p>

<div class="language-r highlighter-rouge"><pre class="highlight"><code><span class="n">isAdmin</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">reactive</span><span class="p">({</span><span class="w">
  </span><span class="nf">is.null</span><span class="p">(</span><span class="n">session</span><span class="o">$</span><span class="n">user</span><span class="p">)</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="n">session</span><span class="o">$</span><span class="n">user</span><span class="w"> </span><span class="o">%in%</span><span class="w"> </span><span class="n">adminUsers</span><span class="w">
</span><span class="p">})</span><span class="w">  
</span></code></pre>
</div>

<p>This will assume that when there is no authentication, everyone is an admin, but when authentication is enabled, it will look at the admin users list.</p>

<p>That’s it! You are now ready to create forms with shiny apps.  You can see what the final app code looks like <a href="https://github.com/daattali/shiny-server/blob/master/mimic-google-form/app.R">on GitHub</a> (with a few minor modifications), or test it out <a href="http://daattali.com/shiny/mimic-google-form/">on my shiny server</a>).</p>

<h1 id="updates">Updates</h1>

<p><strong>[2015-06-15]</strong> As mentioned in the comments below, if you don’t have a Pro account but would still like to implement the idea of admins and “authentication”, there are other ways to achieve a similar result. I won’t go into any of them because I haven’t done that, but it’s definitely possible to have an input field that accepts a password and if you type in an admin password, the tables will be shown. That’s just one example, you can get more creative with the specifics, but essentially you just need a way to return a TRUE/FALSE value from <code class="highlighter-rouge">isAdmin()</code>.</p>

<p><strong>[2015-07-01]</strong> Added a link to the <a href="http://deanattali.com/blog/shiny-persistent-data-storage">follow-up post</a> on how to store data in Shiny apps.</p>

<p><strong>[2015-09-28]</strong> Here are two articles that others have written as extensions of this tutorial: <a href="https://pviefers.wordpress.com/2015/08/16/programming-simple-economic-experiments-in-shiny/">Programming simple economic experiments in Shiny</a> and <a href="http://ipub.com/shiny-crud-app/">Supporting CRUD in Shiny tables</a>.</p>

      </article>
      
      
        <div class="blog-tags">
          Tags: professional, rstats, r, r-bloggers, shiny, shinyjs, tutorial, popular
        </div>
      

      
  <div class="share-section">
    <h1 class="share-title">Liked what you read?</h1>
    
    
      <div class="share-buttons">
        
        
        
        
    
        
        
        
        
        <a href="http://localhost:4000/contact" data-ga-event=1 data-ga-category="share" data-ga-action="message" data-ga-label="/2015/06/14/mimicking-google-form-shiny/">
          Let me know
        </a>
        <!--
        <a href="https://www.facebook.com/dialog/feed?app_id=536330676521989&link=http://localhost:4000/2015/06/14/mimicking-google-form-shiny/&name=Mimicking a Google Form with a Shiny app&caption=nitinitleen1.github.io&redirect_uri=http://localhost:4000/2015/06/14/mimicking-google-form-shiny/?message=Thanks for sharing!&picture=http://deanattali.com/img/blog/mimic-google-form-shiny/mimic-google-form-shiny-final.png" data-ga-event=1 data-ga-category="share" data-ga-action="facebook" data-ga-label="/2015/06/14/mimicking-google-form-shiny/">
          Share on Facebook
        </a>
        -->
        <a href="https://www.paypal.me/daattali/10" data-ga-event=1 data-ga-category="share" data-ga-action="donate" data-ga-label="/2015/06/14/mimicking-google-form-shiny/">
          Support me
        </a>
        <a href="https://twitter.com/intent/tweet?url=http://localhost:4000/2015/06/14/mimicking-google-form-shiny/&via=daattali&hashtags=rstats&text=Mimicking a Google Form with a Shiny app" data-ga-event=1 data-ga-category="share" data-ga-action="twitter" data-ga-label="/2015/06/14/mimicking-google-form-shiny/">
          Tweet it
        </a>
      </div>
    
    
    
      <!-- MailChimp Signup Form -->
      <div id="mailchimp-subscribe-section-2">
        <div id="mc_embed_signup-2">
          <form action="//deanattali.us14.list-manage.com/subscribe/post?u=a579a88c8f09f9b8502b9d0c3&amp;id=c180f5773c" method="post" id="mc-embedded-subscribe-form-2" name="mc-embedded-subscribe-form" class="validate" target="_blank" novalidate>
            <div id="mc_embed_signup_scroll-2">
      	      <label for="mce-EMAIL-2">Sign up to my Shiny newsletter</label>
              <div class="container">
                <div class="row">
                  <div class="col-xs-8">
                    <input type="email" value="" name="EMAIL" class="email" id="mce-EMAIL-2" placeholder="Email" required="">
                  </div>
                  <div class="col-xs-4">
                    <input type="text" value="" name="FNAME" class="text" id="mce-FNAME-2" placeholder="Name" required="">
                  </div>
                </div>
              </div>
              <div style="position: absolute; left: -5000px;" aria-hidden="true"><input type="text" name="b_a579a88c8f09f9b8502b9d0c3_c180f5773c" tabindex="-1" value=""></div>
              <input type="submit" value="Subscribe" name="subscribe" id="mc-embedded-subscribe-2" class="button">
            </div>
          </form>
        </div>
      </div>
     

  </div>


      
      

      <ul class="pager blog-pager">
        
          <li class="previous">
            <a href="/2015/05/31/shinyjs-extend/" data-toggle="tooltip" data-placement="top" title="New shinyjs version: Useful tools for any Shiny app developer + easily call JavaScript functions as R code">&larr; Previous Post</a>
          </li>
        
        
          <li class="next">
            <a href="/2015/06/28/introducing-shinyjs-colourinput/" data-toggle="tooltip" data-placement="top" title="Shiny finally has a colour picker - use colourInput to select colours in Shiny apps">Next Post &rarr;</a>
          </li>
        
      </ul>

      
        <div class="disqus-comments">
          
<div class="comments">
	<div id="disqus_thread"></div>
	<script type="text/javascript">
	    var disqus_shortname = 'nitin-site';
	    // ensure that pages with query string or anchor get the same discussion
            var url_parts = window.location.href.split("?");
            url_parts = url_parts[0].split("#");
            disqus_url = url_parts[0];
            disqus_url = disqus_url.replace(/(\/)*$/, "/"); // make sure the URL ends with one slash
            
            // Jekyll 3 caused so many bugs, I'm tired of fixing them one by one properly, so I'll just hack it...
            // https://github.com/jekyll/jekyll/issues/4483
            // The projects page now has a trailing slash, it didn't used to
            if (disqus_url.substr(-9) == "projects/") {
            	disqus_url = disqus_url.substr(0, disqus_url.length - 1);
            }

	    (function() {
	        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
	        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
	        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
	    })();
	</script>
	<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
</div>


        </div>
      
      
      <div id="scroll-box">
  <div id="scroll-box-close">&times;</div>
  <div id="scroll-box-hire">
    Need Shiny help?
    <a href="/shiny">Hire me!</a>
  </div>
  <div id="mailchimp-subscribe-section">
    <div id="mc_embed_signup">
      <form action="//deanattali.us14.list-manage.com/subscribe/post?u=a579a88c8f09f9b8502b9d0c3&amp;id=c180f5773c" method="post" id="mc-embedded-subscribe-form" name="mc-embedded-subscribe-form" class="validate" target="_blank" novalidate="">
        <div id="mc_embed_signup_scroll">
  	      <label for="mce-EMAIL">Sign up to my Shiny newsletter</label>
          <div class="container">
            <div class="row">
              <div class="col-xs-8">
  	            <input type="email" value="" name="EMAIL" class="email" id="mce-EMAIL" placeholder="Email" required="">
              </div>
              <div class="col-xs-4">
                <input type="text" value="" name="FNAME" class="text" id="mce-FNAME" placeholder="Name" required="">
              </div>
            </div>
          </div>
          <div style="position: absolute; left: -5000px;" aria-hidden="true"><input type="text" name="b_a579a88c8f09f9b8502b9d0c3_c180f5773c" tabindex="-1" value=""></div>
          <input type="submit" value="Subscribe" name="subscribe" id="mc-embedded-subscribe" class="button" title="Sign up to my Shiny newsletter">
        </div>
      </form>
    </div>
  </div>
  <div id="scroll-box-contact">
    Questions/comments?
    <a href="/contact">Contact me!</a>
  </div>
</div>

    </div>
  </div>
</div>


    <footer>
  <div class="container">
    <div class="row">
      <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
        <ul class="list-inline text-center footer-links">

          
          <li>
            <a href="mailto:nitin.iiitv@gmail.com?subject=Hello from nitinitleen1.github.io" title="Email me">
              <span class="fa-stack fa-lg">
                <i class="fa fa-circle fa-stack-2x"></i>
                <i class="fa fa-envelope fa-stack-1x fa-inverse"></i>
              </span>
            </a>
          </li>
          

          
          <li>
            <a href="https://twitter.com/nitinkumarsin10" title="Twitter">
              <span class="fa-stack fa-lg">
                <i class="fa fa-circle fa-stack-2x"></i>
                <i class="fa fa-twitter fa-stack-1x fa-inverse"></i>
              </span>
            </a>
          </li>
          

          
          <li>
            <a href="https://github.com/nitinitleen1" title="GitHub">
              <span class="fa-stack fa-lg">
                <i class="fa fa-circle fa-stack-2x"></i>
                <i class="fa fa-github fa-stack-1x fa-inverse"></i>
              </span>
            </a>
          </li>
          

          
          <li>
            <a href="https://www.facebook.com/nitin.singh.357622" title="Facebook">
              <span class="fa-stack fa-lg">
                <i class="fa fa-circle fa-stack-2x"></i>
                <i class="fa fa-facebook fa-stack-1x fa-inverse"></i>
              </span>
            </a>
          </li>
          

          
          <li>
            <a href="https://stackoverflow.com/users/7629885/nitin-singh" title="StackOverflow">
              <span class="fa-stack fa-lg">
                <i class="fa fa-circle fa-stack-2x"></i>
                <i class="fa fa-stack-overflow fa-stack-1x fa-inverse"></i>
              </span>
            </a>
          </li>
          

          

          

        </ul>

        <p class="copyright text-muted">
          &copy; Nitin Singh
          &nbsp;&bull;&nbsp;
          2019

          
          &nbsp;&bull;&nbsp;
          <a href="mailto:nitin.iiitv@gmail.com?subject=Hello from nitinitleen1.github.io">nitin.iiitv@gmail.com</a>
          
        </p>
        <p class="theme-by text-muted">
          Theme by
          <a href="http://deanattali.com/beautiful-jekyll/">beautiful-jekyll</a>
        </p>
      </div>
    </div>
  </div>
</footer>

    
    


  
	<script src="/js/jquery-1.11.2.min.js"></script>
  
	<script src="/js/bootstrap.min.js"></script>
  
	<script src="/js/js.cookie.js"></script>
  
	<script src="/js/main.js"></script>
  







	<!-- Google Analytics -->
	<script>
		(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
		(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
		m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
		})(window,document,'script','//www.google-analytics.com/analytics.js','ga');
		ga('create', 'UA-59820529-1', 'auto');
		ga('send', 'pageview');
	</script>
	<!-- End Google Analytics -->



     
      <!-- AddThis plugin (floating social media sharing buttons on the left of each post) -->
      <script type="text/javascript" src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-57d65a4d97789dd1"></script>
    
    
  </body>
</html>
